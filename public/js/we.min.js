var WE={extend:$.extend,ui:{},kit:{},api:{},page:{},Observer:{notice:function(){Array.prototype.unshift.call(arguments,{target:this,data:arguments[0]});for(var a=0;this.observers&&a<this.observers.length;a++)try{this.observers[a].update.apply(this.observers[a],arguments)}catch(b){window.console&&console.log(b)}},addObserver:function(a){if(a&&a.update){if(!this.observers)this.observers=[];this.observers.push(a)}else console.error("observer.update not fucntion ")},removeObserver:function(a){for(var b=
0;this.observers&&b<this.observers.length;b++)a===this.observers[b]&&(this.observers.splice(b,1),b--)}}};WE.Controller=function(a){this.msg={"-99":"\u670d\u52a1\u5668\u9519\u8bef"};a&&WE.extend(this,a)};WE.Controller.prototype={constructor:WE.Controller,update:function(a){a.code!=0&&WE.ui.alert(this.getCodeMsg(a.code))},error:function(a){window.console&&console.log("xhr \u9519\u8bef",a.status)},getCodeMsg:function(a){var b=this.msg?this.msg[a]:null;return b?b:"\u9519\u8bef\u4ee3\u7801:"+a}};
WE.BaseModel=function(a){this.init(a)};WE.BaseModel.prototype={constructor:WE.BaseModel,init:function(a){a&&WE.extend(this,a)},error:function(a,b){for(var d=this.observers,c=0;d&&c<d.length;c++)d[c].error&&d[c].error(a,b)},post:function(a,b){var d=this;$.ajax({url:a,type:"post",data:b,dataType:"json",error:function(b,a){d.error(b,a)},success:function(b){d.notice(b)}})},get:function(a,b){var d=this;$.ajax({url:a,type:"get",data:b,dataType:"json",error:function(b,a){d.error(b,a)},success:function(b){d.notice(b)}})}};
WE.extend(WE.BaseModel.prototype,WE.Observer);WE.extend(WE.kit,function(){function a(b){var a={dragElement:null,moveElement:null,isRange:!0,isResize:!0,patchWidth:0,patchHeight:0,patchTop:0,patchLeft:0};this.left=this.top=this.height=this.width=0;$.extend(a,b);this.option=a;this.events={}}a.prototype={init:function(){var b=this;this.option.iscap=this.option.dragElement[0].setCapture?!0:!1;$.extend(this.events,{down:function(a){b.down(a);return!1},up:function(a){b.up(a);return!1},move:function(a){b.move(a);return!1}});this.zIndex();this.createMask();
this.option.isRange&&!this.option.range&&this.setRangeWindow();this.start();this.setResize();this.onready()},zIndex:function(){this.minzIndex=this.option.dragElement.css("z-index")||10},createMask:function(){this.mask=$('<div style="position:fixed;display:none;top:0;left:0;opacity:0;background:#000;filter:alpha(opacity=0)"></div>');this.setMask(0,0,$(window).width(),$(window).height(),this.minzIndex+1);$("#mxDialogWarp").append(this.mask)},showMask:function(){this.mask.show()},hideMask:function(){this.mask.hide()},
removeMask:function(){this.mask.remove()},setMask:function(b,a,c,e,f){this.mask.css({top:b,left:a,width:c,height:e,"z-index":f})},setMaskIndex:function(b){this.mask.css("z-index",b||WE.ui.Dialog.index)},start:function(){this.option.dragElement.bind("mousedown",this.events.down)},down:function(b){var a=this.option.dragElement,c=this.option.moveElement,e=$(document),f=c.offset();this.width=c.width();this.height=c.height();this.setRangeWindow();this.option.iscap&&a[0].setCapture();this.offset={x:b.screenX-
f.left,y:b.screenY-f.top};this.showMask();e.bind("mousemove",this.events.move);e.bind("mouseup",this.events.up);this.onfocus(b.screenX,b.screenY)},move:function(b){var a=this.option.moveElement,c=this.offset,e=b.screenX-c.x-$(window).scrollLeft(),b=b.screenY-c.y-$(window).scrollTop();if(this.option.isRange)b=this.checkBoundary(e,b),e=b.x,b=b.y;this.left=e;this.top=b;a[0].style.left=e+"px";a[0].style.top=b+"px";this.onmove(e,b)},up:function(){var b=$(document),a=this.option.dragElement;this.option.iscap&&
a[0].releaseCapture();this.hideMask();b.unbind("mousemove",this.events.move);b.unbind("mouseup",this.events.up);this.onblur()},stop:function(){this.removeMask()},checkBoundary:function(b,a){var c=this.option.range;$("#movebox").text(c[3]+"-"+this.height);b=b>c[2]-this.width?c[2]-this.width:b;a=a>c[3]-this.height?c[3]-this.height:a;b=b<c[0]?c[0]:b;a=a<c[1]?c[1]:a;return{x:b,y:a}},setResize:function(){var b=this;if(!this.option.isResize)return this.option.moveElement.find(".mx-dialog-change").hide(),
!1;this.resize=new WE.kit.Resize({dragElements:this.option.moveElement.find(".mx-dialog-change"),sizeElement:this.option.moveElement});this.resize.onfocus=function(){b.showMask();b.setMaskIndex()};this.resize.onblur=function(a,c,e,f){b.width=a;b.height=c;b.top=f;b.left=e;b.onResize();b.hideMask()};this.resize.init()},setRange:function(a,d,c,e){this.option.range=[a,d,c,e]},setRangeWindow:function(){var a=this.option.patchTop,d=this.option.patchLeft,c=$(window).width()-this.option.patchWidth,e=$(window).height()-
this.option.patchHeight;this.option.range=[d,a,c,e];this.setMask(0,0,c,e,this.minzIndex)},onfocus:function(){},onblur:function(){},onmove:function(){},onexit:function(){},onready:function(){},onResize:function(){}};return{DragElement:a}}());WE.kit.textarea={getPos:function(a){if(document.selection){a.focus();var b=document.selection.createRange(),d=b.duplicate();d.moveToElementText(a);d.setEndPoint("EndToEnd",b);a.selectionStart=d.text.length-b.text.length;a.selectionEnd=a.selectionStart+b.text.length}return a.selectionStart},setPos:function(a,b){this.select(a,b,b)},add:function(a,b){if(document.selection)a.focus(),document.selection.createRange().text=b;else{var d=a.selectionStart,c=a.value.length;a.value=a.value.slice(0,a.selectionStart)+
b+a.value.slice(a.selectionStart,c);this.setPos(a,d+b.length)}},del:function(a,b){var d=this.getPos(a),c=a.value;a.value=b>0?c.slice(0,d-b)+c.slice(d):c.slice(0,d)+c.slice(d-b);this.setPos(a,d-(b<0?0:b))},select:function(a,b,d){if(document.selection){var c=a.createTextRange();c.moveEnd("character",-a.value.length);c.moveEnd("character",d);c.moveStart("character",b);c.select()}else a.setSelectionRange(b,d),a.focus()},selectString:function(a,b){var d=a.value.indexOf(b);d!=-1&&this.select(a,d,d+b.length)}};
