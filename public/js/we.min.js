var WE={extend:$.extend,ui:{},kit:{},api:{},page:{},Observer:{notice:function(){Array.prototype.unshift.call(arguments,{target:this,data:arguments[0]});for(var a=0;this.observers&&a<this.observers.length;a++)try{this.observers[a].update.apply(this.observers[a],arguments)}catch(b){window.console&&console.log(b)}},addObserver:function(a){if(a&&a.update){if(!this.observers)this.observers=[];this.observers.push(a)}else console.error("observer.update not fucntion ")},removeObserver:function(a){for(var b=
0;this.observers&&b<this.observers.length;b++)a===this.observers[b]&&(this.observers.splice(b,1),b--)}}};WE.Controller=function(a){this.msg={"-99":"\u670d\u52a1\u5668\u9519\u8bef"};a&&WE.extend(this,a)};WE.Controller.prototype={constructor:WE.Controller,update:function(a){a.code!=0&&WE.ui.alert(this.getCodeMsg(a.code))},error:function(a){window.console&&console.log("xhr \u9519\u8bef",a.status)},getCodeMsg:function(a){var b=this.msg?this.msg[a]:null;return b?b:"\u9519\u8bef\u4ee3\u7801:"+a}};
WE.BaseModel=function(a){this.init(a)};WE.BaseModel.prototype={constructor:WE.BaseModel,init:function(a){a&&WE.extend(this,a)},error:function(a,b){for(var c=this.observers,d=0;c&&d<c.length;d++)c[d].error&&c[d].error(a,b)},post:function(a,b){var c=this;$.ajax({url:a,type:"post",data:b,dataType:"json",error:function(b,a){c.error(b,a)},success:function(b){c.notice(b)}})},get:function(a,b){var c=this;$.ajax({url:a,type:"get",data:b,dataType:"json",error:function(b,a){c.error(b,a)},success:function(b){c.notice(b)}})}};
WE.extend(WE.BaseModel.prototype,WE.Observer);WE.extend(WE.kit,{tmpl:function(a,b){var c=!/\W/.test(a)?cache[a]=cache[a]||tmpl(document.getElementById(a).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return b?c(b):c},format:function(a,b){var a=new Date(a),c=this.pad,d=
{yy:String(a.getFullYear()).slice(-2),yyyy:a.getFullYear(),M:a.getMonth()+1,MM:c(a.getMonth()+1,2,"0"),d:a.getDate(),dd:c(a.getDate(),2,"0"),h:a.getHours(),hh:c(a.getHours(),2,"0"),m:a.getMinutes(),mm:c(a.getMinutes(),2,"0"),s:a.getSeconds(),ss:c(a.getSeconds(),2,"0")};return(b||"yyyy-MM-dd hh:mm:ss").replace(/yyyy|yy|MM|M|dd|d|hh|h|mm|m|ss|s/g,function(b){return d[b]})},sortFormat:function(a){return this.format(a,"yyyy-MM-dd")},longFormat:function(a){return this.format(a,"yyyy-MM-dd hh:mm:ss")}});WE.extend(WE.kit,function(){function a(b){var a={dragElement:null,moveElement:null,isRange:!0,isResize:!0,patchWidth:0,patchHeight:0,patchTop:0,patchLeft:0};this.left=this.top=this.height=this.width=0;$.extend(a,b);this.option=a;this.events={}}a.prototype={init:function(){var b=this;this.option.iscap=this.option.dragElement[0].setCapture?!0:!1;$.extend(this.events,{down:function(a){b.down(a);return!1},up:function(a){b.up(a);return!1},move:function(a){b.move(a);return!1}});this.zIndex();this.createMask();
this.option.isRange&&!this.option.range&&this.setRangeWindow();this.start();this.setResize();this.onready()},zIndex:function(){this.minzIndex=this.option.dragElement.css("z-index")||10},createMask:function(){this.mask=$('<div style="position:fixed;display:none;top:0;left:0;opacity:0;background:#000;filter:alpha(opacity=0)"></div>');this.setMask(0,0,$(window).width(),$(window).height(),this.minzIndex+1);$("#mxDialogWarp").append(this.mask)},showMask:function(){this.mask.show()},hideMask:function(){this.mask.hide()},
removeMask:function(){this.mask.remove()},setMask:function(b,a,d,e,f){this.mask.css({top:b,left:a,width:d,height:e,"z-index":f})},setMaskIndex:function(b){this.mask.css("z-index",b||WE.ui.Dialog.index)},start:function(){this.option.dragElement.bind("mousedown",this.events.down)},down:function(b){var a=this.option.dragElement,d=this.option.moveElement,e=$(document),f=d.offset();this.width=d.width();this.height=d.height();this.setRangeWindow();this.option.iscap&&a[0].setCapture();this.offset={x:b.screenX-
f.left,y:b.screenY-f.top};this.showMask();e.bind("mousemove",this.events.move);e.bind("mouseup",this.events.up);this.onfocus(b.screenX,b.screenY)},move:function(b){var a=this.option.moveElement,d=this.offset,e=b.screenX-d.x-$(window).scrollLeft(),b=b.screenY-d.y-$(window).scrollTop();if(this.option.isRange)b=this.checkBoundary(e,b),e=b.x,b=b.y;this.left=e;this.top=b;a[0].style.left=e+"px";a[0].style.top=b+"px";this.onmove(e,b)},up:function(){var b=$(document),a=this.option.dragElement;this.option.iscap&&
a[0].releaseCapture();this.hideMask();b.unbind("mousemove",this.events.move);b.unbind("mouseup",this.events.up);this.onblur()},stop:function(){this.removeMask()},checkBoundary:function(b,a){var d=this.option.range;$("#movebox").text(d[3]+"-"+this.height);b=b>d[2]-this.width?d[2]-this.width:b;a=a>d[3]-this.height?d[3]-this.height:a;b=b<d[0]?d[0]:b;a=a<d[1]?d[1]:a;return{x:b,y:a}},setResize:function(){var b=this;if(!this.option.isResize)return this.option.moveElement.find(".mx-dialog-change").hide(),
!1;this.resize=new WE.kit.Resize({dragElements:this.option.moveElement.find(".mx-dialog-change"),sizeElement:this.option.moveElement});this.resize.onfocus=function(){b.showMask();b.setMaskIndex()};this.resize.onblur=function(a,d,e,f){b.width=a;b.height=d;b.top=f;b.left=e;b.onResize();b.hideMask()};this.resize.init()},setRange:function(b,a,d,e){this.option.range=[b,a,d,e]},setRangeWindow:function(){var b=this.option.patchTop,a=this.option.patchLeft,d=$(window).width()-this.option.patchWidth,e=$(window).height()-
this.option.patchHeight;this.option.range=[a,b,d,e];this.setMask(0,0,d,e,this.minzIndex)},onfocus:function(){},onblur:function(){},onmove:function(){},onexit:function(){},onready:function(){},onResize:function(){}};return{DragElement:a}}());WE.kit.textarea={getPos:function(a){if(document.selection){a.focus();var b=document.selection.createRange(),c=b.duplicate();c.moveToElementText(a);c.setEndPoint("EndToEnd",b);a.selectionStart=c.text.length-b.text.length;a.selectionEnd=a.selectionStart+b.text.length}return a.selectionStart},setPos:function(a,b){this.select(a,b,b)},add:function(a,b){if(document.selection)a.focus(),document.selection.createRange().text=b;else{var c=a.selectionStart,d=a.value.length;a.value=a.value.slice(0,a.selectionStart)+
b+a.value.slice(a.selectionStart,d);this.setPos(a,c+b.length)}},del:function(a,b){var c=this.getPos(a),d=a.value;a.value=b>0?d.slice(0,c-b)+d.slice(c):d.slice(0,c)+d.slice(c-b);this.setPos(a,c-(b<0?0:b))},select:function(a,b,c){if(document.selection){var d=a.createTextRange();d.moveEnd("character",-a.value.length);d.moveEnd("character",c);d.moveStart("character",b);d.select()}else a.setSelectionRange(b,c),a.focus()},selectString:function(a,b){var c=a.value.indexOf(b);c!=-1&&this.select(a,c,c+b.length)}};WE.extend(WE.ui,{ok:function(a,b){var c=this.tip({context:a,okbtn:!1,cancelbtn:!1,type:"success",timeout:b||3E3,title:WE_LANG.lj_234});c.ui.close.focus();return c},alert:function(a,b){if(this.alert.tip)this.alert.tip.option.callback=null,this.alert.tip.close();var c=this.tip({context:a,cancelbtn:!1,type:"notice",callback:b,title:WE_LANG.lj_234});c.ui.ok.focus();return this.alert.tip=c},confirm:function(a,b){if(this.confirm.tip)return this.confirm.tip;var c=this,d=this.tip({context:a,closebtn:!1,type:"notice",
callback:function(a){c.confirm.tip=null;b&&b(a=="ok"?!0:!1)},title:WE_LANG.lj_234});this.confirm.tip=d;d.ui.ok.focus();return d},tip:function(){function a(a){this.option={title:WE_LANG.lj_234,context:"hello world",callback:function(){},timeout:0,okbtn:!0,cancelbtn:!0,closebtn:!0,type:"notice"};$.extend(this.option,a);this.init()}a.prototype={init:function(){var a=WE.kit.tmpl('<div class="moxian-ui-tip">\t\t\t\t<div class="ui-tip-wrapper">\t\t\t\t\t<div class="ui-tip-main">\t\t\t\t\t\t<div class="ui-tip-title">\t\t\t\t\t\t\t<h1><%=title%></h1>\t\t\t\t\t\t\t<%if(closebtn){%>\t\t\t\t\t\t\t<input type="button" class="ui-btn-close pngbg" title="\u5173\u95ed" />\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="ui-tip-context">\t\t\t\t\t\t\t<%if(type){%>\t\t\t\t\t\t\t<p class="p">\t\t\t\t\t\t\t\t<span class="ui-tip-icon ui-tip-<%=type%>"></span><span><%=context%></span>\t\t\t\t\t\t\t</p>\t\t\t\t\t\t\t<%}else{%>\t\t\t\t\t\t\t\t<%=context%>\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="ui-tip-btn">\t\t\t\t\t\t\t<%if(okbtn){%>\t\t\t\t\t\t\t\t<input type="button" title="\u786e\u5b9a" class="btn-primary js_ok" value="\u786e\u5b9a" />\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t\t<%if(cancelbtn){%>\t\t\t\t\t\t\t\t<input type="button" title="\u53d6\u6d88" class="btn marl10 js_cancel" value="\u53d6\u6d88" />\t\t\t\t\t\t\t<%}%>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="ui-tip-bg">\u80cc\u666f</div>\t\t\t</div>',
this.option),a=$("<div></div>").append(a);this.ui={wrapper:a.find(".moxian-ui-tip"),title:a.find(".ui-tip-title"),close:a.find(".ui-btn-close"),ok:a.find(".js_ok"),cancel:a.find(".js_cancel")};$(document.body).append(a.find(".moxian-ui-tip"));this.regEvent();this.option.timeout&&this.setTimeout(this.option.timeout);(new WE.kit.DragElement({dragElement:this.ui.title,moveElement:this.ui.wrapper,isRange:!1,isResize:!1,offsetTop:0})).init();this.updatePos()},regEvent:function(){function a(d){d.keyCode==
27&&(c.close("close"),$(window).unbind("keyup",a))}var c=this;this.ui.close.click(function(){c.close("close")});this.ui.ok.click(function(){c.close("ok")});this.ui.cancel.click(function(){c.close("cancel")});$(document).keyup(a)},close:function(a){this.ui.wrapper.remove();this.option.callback&&this.option.callback(a)},updatePos:function(){var a=$(window).height(),c=$(window).width();this.setPos((a-this.ui.wrapper.height())/2,(c-this.ui.wrapper.width())/2)},setTimeout:function(a){var c=this;setTimeout(function(){c.close("auto")},
a)},setPos:function(a,c){this.ui.wrapper.css({top:a+"px",left:c+"px"})}};return function(b){return new a(b)}}()});
